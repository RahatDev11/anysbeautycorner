<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ধন্যবাদ - আপনার অর্ডারটি গ্রহণ করা হয়েছে</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
</head>
<body>
    <header id="header"></header>

    <main class="container mx-auto px-4 py-8">
        <div class="max-w-2xl mx-auto bg-white p-8 rounded-lg shadow-lg text-center">
            <i class="fas fa-check-circle text-green-500 text-6xl mb-4"></i>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">অর্ডার করার জন্য আপনাকে ধন্যবাদ!</h1>
            <p class="text-gray-600 mb-6">আপনার অর্ডারটি সফলভাবে গ্রহণ করা হয়েছে। আমরা শীঘ্রই আপনার সাথে যোগাযোগ করব।</p>

            <div id="orderDetails" class="text-left bg-gray-50 p-6 rounded-lg">
                <h2 class="text-xl font-semibold mb-4 border-b pb-2">অর্ডারের সারসংক্ষেপ</h2>
                <div id="orderInfo">
                    <p><strong>অর্ডার আইডি:</strong> <span id="orderId"></span></p>
                    <p><strong>অর্ডারের তারিখ:</strong> <span id="orderDate"></span></p>
                    <p><strong>স্ট্যাটাস:</strong> <span id="orderStatus"></span></p>
                </div>
                <div id="customerInfo" class="mt-4">
                    <h3 class="font-semibold">গ্রাহকের তথ্য</h3>
                    <p><strong>নাম:</strong> <span id="customerName"></span></p>
                    <p><strong>ফোন নম্বর:</strong> <span id="customerPhone"></span></p>
                    <p><strong>ডেলিভারি ঠিকানা:</strong> <span id="customerAddress"></span></p>
                </div>
                <div id="orderItems" class="mt-4">
                    <h3 class="font-semibold">অর্ডার আইটেম</h3>
                    <div id="itemsList" class="divide-y divide-gray-200"></div>
                </div>
                <div id="priceDetails" class="mt-4 pt-4 border-t">
                    <p class="flex justify-between"><strong>সাবটোটাল:</strong> <span id="subTotal"></span></p>
                    <p class="flex justify-between"><strong>ডেলিভারি ফি:</strong> <span id="deliveryFee"></span></p>
                    <p class="flex justify-between font-bold text-lg"><strong>মোট:</strong> <span id="totalAmount"></span></p>
                </div>
            </div>

            <div class="mt-8">
                <a href="index.html" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors">শপিং চালিয়ে যান</a>
                <a href="order-list.html" class="ml-4 bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition-colors">আমার সকল অর্ডার দেখুন</a>
            </div>
        </div>
    </main>

    <footer id="footer"></footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCVSzQS1c7H4BLhsDF_fW8wnqUN4B35LPA",
            authDomain: "nahid-6714.firebaseapp.com",
            databaseURL: "https://nahid-6714-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "nahid-6714",
            storageBucket: "nahid-6714.firebasestorage.app",
            messagingSenderId: "505741217147",
            appId: "1:505741217147:web:25ed4e9f0d00e3c4d381de",
            measurementId: "G-QZ7CTRKHCW"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        function loadPartials() {
            $("#header").load("header.html");
            $("#footer").load("footer.html");
        }

        async function fetchOrderDetails(orderId) {
            const orderRef = ref(database, 'orders/' + orderId);
            try {
                const snapshot = await get(orderRef);
                if (snapshot.exists()) {
                    const orderData = snapshot.val();
                    displayOrderDetails(orderData);
                } else {
                    document.getElementById('orderDetails').innerHTML = '<p class="text-red-500">দুঃখিত, এই অর্ডার আইডি দিয়ে কোনো অর্ডার খুঁজে পাওয়া যায়নি।</p>';
                }
            } catch (error) {
                console.error("Error fetching order details:", error);
                document.getElementById('orderDetails').innerHTML = '<p class="text-red-500">অর্ডার তথ্য লোড করতে সমস্যা হয়েছে।</p>';
            }
        }

        function displayOrderDetails(order) {
            document.getElementById('orderId').textContent = order.orderId;
            document.getElementById('orderDate').textContent = new Date(order.timestamp).toLocaleString('bn-BD');
            document.getElementById('orderStatus').textContent = order.orderStatus;
            document.getElementById('customerName').textContent = order.customerName;
            document.getElementById('customerPhone').textContent = order.phoneNumber;
            document.getElementById('customerAddress').textContent = order.address;

            const itemsList = document.getElementById('itemsList');
            itemsList.innerHTML = '';
            order.items.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'py-2 flex justify-between';
                itemElement.innerHTML = `
                    <div>
                        <p class="font-semibold">${item.name} ${item.variant ? `(${item.variant})` : ''}</p>
                        <p class="text-sm text-gray-500">পরিমাণ: ${item.quantity}</p>
                    </div>
                    <p class="text-gray-800">${(item.price * item.quantity).toFixed(2)} টাকা</p>
                `;
                itemsList.appendChild(itemElement);
            });

            document.getElementById('subTotal').textContent = `${order.subTotal.toFixed(2)} টাকা`;
            document.getElementById('deliveryFee').textContent = `${order.deliveryFee.toFixed(2)} টাকা`;
            document.getElementById('totalAmount').textContent = `${order.totalAmount.toFixed(2)} টাকা`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadPartials();
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('orderId');
            if (orderId) {
                fetchOrderDetails(orderId);
            } else {
                document.getElementById('orderDetails').innerHTML = '<p class="text-red-500">কোনো অর্ডার আইডি পাওয়া যায়নি।</p>';
            }
        });
    </script>
</body>
</html>